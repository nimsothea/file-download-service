<?xml version="1.0" encoding="UTF-8"?>
<configuration xmlns:mode="http://www.modeshape.org/1.0" xmlns:jcr="http://www.jcp.org/jcr/1.0">

    <mode:sources jcr:primaryType="nt:unstructured">
    
       <mode:source jcr:name="meta" mode:classname="org.modeshape.graph.connector.inmemory.InMemoryRepositorySource"
       	    mode:defaultWorkspaceName="w1"/>
    
       <!-- <mode:source jcr:name="aineistot" mode:classname="org.modeshape.graph.connector.inmemory.InMemoryRepositorySource"
       	    mode:defaultWorkspaceName="w"/> -->
         
       <mode:source jcr:name="filestore" 
                     mode:classname="org.modeshape.connector.filesystem.FileSystemSource"
                   	 mode:workspaceRootPath="./target/test-classes/repository"
 		          	 mode:updatesAllowed="true"
 		          	 mode:defaultWorkspaceName="workspace"/>
         
       <mode:source jcr:name="aineistot"
      	mode:classname="org.modeshape.graph.connector.federation.FederatedRepositorySource">
      	    <mode:workspaces>
		<mode:workspace jcr:name="default">
			<mode:projections>
			<mode:projection jcr:name="Meta Projection" mode:source="meta" mode:workspaceName="w1">
				<mode:projectionRules>/meta => /</mode:projectionRules>
			</mode:projection>
			<mode:projection jcr:name="Aineistot Projection" mode:source="filestore" mode:workspaceName="workspace">
				<mode:projectionRules>/ => /</mode:projectionRules>
			</mode:projection>
						<!-- 
			<mode:projection jcr:name="System Projection" mode:sourc="System" mode:workspaceName="default">
				<mode:projectionRules>/jcr:system => /</mode:projectionRules>
			</mode:projection>-->
			</mode:projections>
		
		</mode:workspace>
	</mode:workspaces>
	 <mode:cachePolicy jcr:name="nodeCachePolicy"
     				mode:classname="org.modeshape.graph.connector.base.cache.InMemoryNodeCache$MapCachePolicy"
     					mode:timeToLive="3600"/>	
      </mode:source>
         
    </mode:sources>

    <mode:sequencers/>
    
    <mode:mimeTypeDetectors>
        <mode:mimeTypeDetector jcr:name="Detector">
            <mode:description>Standard extension-based MIME type detector</mode:description>        
            <mode:classname>org.modeshape.graph.mimetype.ExtensionBasedMimeTypeDetector</mode:classname>
        </mode:mimeTypeDetector>
    </mode:mimeTypeDetectors>

    <mode:repositories>
         
         <mode:repository jcr:name="meta">
    		<mode:source>meta</mode:source>
    		<mode:options jcr:primaryType="mode:options">
    			<projectNodeTypes jcr:primaryType="mode:option" mode:value="true"/>
    			<queryExecutionEnabled>false</queryExecutionEnabled>
            	<!-- <queryIndexDirectory jcr:primaryType="mode:option" mode:value="target/jcr/data/metaindex"/>
            	<rebuildQueryIndexOnStartup jcr:primaryType="mode:option" mode:value="ifMissing"/>
            	<queryIndexesRebuiltSynchronously jcr:primaryType="mode:option" mode:value="true" />
            	<queryIndexesUpdatedSynchronously jcr:primaryType="mode:option" mode:value="true" /> -->
            </mode:options>
            <jcr:nodeTypes mode:resource="metadata.cnd" />
            <mode:nodeTypes jcr:primaryType="mode:nodeTypes"/>
            <namespaces jcr:primaryType="mode:namespaces" />
    	</mode:repository>
    
        <mode:repository jcr:name="aineistot">
            <mode:source>aineistot</mode:source>
            <mode:options jcr:primaryType="mode:options">
				<projectNodeTypes jcr:primaryType="mode:option" mode:value="true"/>
 				<jaasLoginConfigName jcr:primaryType="mode:option" mode:value=""/>
                <anonymousUserRoles jcr:primaryType="mode:option" mode:value=""/> <!-- should be null valued -->
                <useAnonymousAccessOnFailedLogin jcr:primaryType="mode:option" mode:value="false"/>
                <useSecurityContextCredentials jcr:primaryType="mode:option" mode:value="false"/>
                <queryExecutionEnabled>true</queryExecutionEnabled>
                <queryIndexDirectory jcr:primaryType="mode:option" mode:value="target/jcr/data/index"/> 
                <rebuildQueryIndexOnStartup jcr:primaryType="mode:option" mode:value="ifMissing"/>
                <queryIndexesRebuiltSynchronously jcr:primaryType="mode:option" mode:value="true" />
                <queryIndexesUpdatedSynchronously jcr:primaryType="mode:option" mode:value="true" />
            </mode:options>
            <jcr:nodeTypes mode:resource="metadata.cnd" />
            <mode:nodeTypes jcr:primaryType="mode:nodeTypes"/>
            <namespaces jcr:primaryType="mode:namespaces" />
      		<mode:authenticationProviders>
             <mode:authenticationProvider jcr:name="DummyAuthenticator"
                        mode:classname="fi.nls.tiepalinfra.jcr.repository.DummyAuthenticationProvider">
             </mode:authenticationProvider>
             </mode:authenticationProviders>
        </mode:repository>
    </mode:repositories>
    
</configuration>
